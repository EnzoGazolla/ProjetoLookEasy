<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meus Pedidos - LookEasy</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <!-- Header Principal -->
    <header class="main-header">
        <div class="header-container">
            <div class="logo">
                <a href="index.html" style="text-decoration: none; color: inherit;">
                    <h1>LookEasy</h1>
                </a>
            </div>

            <div class="search-bar">
                <input type="text" placeholder="Buscar produtos...">
                <button class="search-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                </button>
            </div>

            <div class="header-icons">
                <div class="profile-container">
                    <button class="icon-btn profile-btn" title="Perfil" onclick="toggleProfileMenu()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                        </svg>
                    </button>
                    <div class="profile-dropdown" id="profileDropdown">
                        <!-- Content will be populated dynamically -->
                    </div>
                </div>
                <button class="icon-btn" title="Carrinho" onclick="openCart()">
                    <div class="cart-icon-wrapper">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" />
                        </svg>
                        <span id="cartCount" class="cart-count" style="display: none;">0</span>
                    </div>
                </button>
            </div>
        </div>

        <!-- Sub-header com Categorias -->
        <div class="sub-header">
            <div class="dropdown">
                <button class="dropdown-btn" onclick="toggleDropdown()">
                    Categorias ‚ñº
                </button>
                <div class="dropdown-content" id="categoryDropdown">
                    <a href="feminino.html">Feminino</a>
                    <a href="masculino.html">Masculino</a>
                    <a href="acessorios.html">Acess√≥rios</a>
                    <a href="outros.html">Outros</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Container Principal -->
    <div class="pedidos-container">
        <div class="pedidos-header">
            <h1>Meus Pedidos</h1>
            <p>Acompanhe o status dos seus pedidos</p>
        </div>

        <div class="pedidos-list" id="pedidosList">
            <!-- Pedidos ser√£o carregados aqui -->
        </div>

        <div class="no-pedidos" id="noPedidos" style="display: none;">
            <div class="no-pedidos-icon">üì¶</div>
            <h3>Voc√™ ainda n√£o fez nenhum pedido</h3>
            <p>Comece a explorar nossos produtos e fa√ßa seu primeiro pedido!</p>
            <a href="index.html" class="cta-button">Ir √†s Compras</a>
        </div>
    </div>

    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Institucional</h3>
                <ul>
                    <li><a href="SobreNos.html">Sobre n√≥s</a></li>
                    <li><a href="Atendimento.html">Atendimento</a></li>
                    <li><a href="PoliticaDePrivacidade.html">Pol√≠tica de Privacidade</a></li>
                    <li><a href="TrocasEDevolucoes.html">Trocas e Devolu√ß√µes</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Redes Sociais</h3>
                <div class="social-icons">
                    <a href="https://www.facebook.com" target="_blank" title="Facebook"><i
                            class="fab fa-facebook"></i></a>
                    <a href="https://www.instagram.com" target="_blank" title="Instagram"><i
                            class="fab fa-instagram"></i></a>
                    <a href="https://twitter.com" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="https://www.youtube.com" target="_blank" title="YouTube"><i class="fab fa-youtube"></i></a>
                </div>
            </div>

            <div class="footer-section">
                <h3>Formas de Pagamento</h3>
                <div class="payment-icons">
                    <span class="payment-icon">üí≥ Visa</span>
                    <span class="payment-icon">üí≥ Master</span>
                    <span class="payment-icon">üí≥ Amex</span>
                    <span class="payment-icon">üí≥ Pix</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal do Carrinho -->
    <div id="cartModal" class="cart-modal">
        <div class="cart-overlay" onclick="closeCart()"></div>
        <div class="cart-content">
            <div class="cart-header">
                <h2>Meu Carrinho</h2>
                <button class="cart-close-btn" onclick="closeCart()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                </button>
            </div>

            <div class="cart-body">
                <div id="cartItems" class="cart-items"></div>
                <div id="cartEmpty" class="cart-empty" style="display: none;">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor" style="opacity: 0.3;">
                        <path
                            d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" />
                    </svg>
                    <p>Seu carrinho est√° vazio</p>
                    <button class="continue-shopping-btn" onclick="closeCart()">Continuar Comprando</button>
                </div>
            </div>

            <div class="cart-footer">
                <div class="cart-total">
                    <span>Total:</span>
                    <span id="cartTotal">R$ 0,00</span>
                </div>
                <div class="cart-actions">
                    <button class="clear-cart-btn" onclick="clearCart()">Limpar Carrinho</button>
                    <button class="checkout-btn" onclick="checkout()">Finalizar Compra</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/database.js"></script>
    <script src="js/auth.js"></script>
    <script>
    // Proteger p√°gina - apenas usu√°rios logados
    document.addEventListener('DOMContentLoaded', function () {
        // Inicializar banco e auth
        if (typeof auth !== 'undefined') {
            auth.init();
            if (!auth.isLoggedIn()) {
                window.location.href = 'login.html';
                return;
            }
        }

        // Carregar pedidos
        loadPedidos();
        
        // Atualizar contador do carrinho (header)
        updateCartCount();
    });

    // Carregar pedidos do usu√°rio logado
    function loadPedidos() {
        const session = db.getCurrentSession();
        if (!session) return;

        // Busca pedidos espec√≠ficos deste usu√°rio no "Banco de Dados"
        const pedidos = db.getOrdersByUser(session.user.id);
        
        const pedidosList = document.getElementById('pedidosList');
        const noPedidos = document.getElementById('noPedidos');

        // Se n√£o tiver pedidos, mostra a mensagem de vazio
        if (pedidos.length === 0) {
            pedidosList.style.display = 'none';
            noPedidos.style.display = 'block';
            return;
        }

        pedidosList.style.display = 'flex';
        noPedidos.style.display = 'none';

        // Renderiza cada pedido
        pedidosList.innerHTML = pedidos.map(pedido => {
            // Formatar Data
            const data = new Date(pedido.dataPedido);
            const dataFormatada = data.toLocaleDateString('pt-BR') + ' √†s ' + data.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});

            // Configurar Status (Cor e Texto)
            const statusMap = {
                'pendente': { text: 'Pendente', class: 'status-pendente' }, // Amarelo
                'processando': { text: 'Processando', class: 'status-processando' }, // Azul
                'enviado': { text: 'Enviado', class: 'status-enviado' }, // Verde claro
                'entregue': { text: 'Entregue', class: 'status-entregue' }, // Verde escuro
                'cancelado': { text: 'Cancelado', class: 'status-cancelado' } // Vermelho
            };
            
            const statusInfo = statusMap[pedido.status] || { text: pedido.status, class: '' };
            const podeCancelar = pedido.status === 'pendente' || pedido.status === 'processando';

            // HTML dos itens do pedido
            const itensHtml = pedido.itens.map(item => `
                <div class="pedido-item">
                    <div class="pedido-item-image">
                        <img src="${item.imagem}" alt="${item.nome}">
                    </div>
                    <div class="pedido-item-details">
                        <div class="pedido-item-nome">${item.nome}</div>
                        ${item.tamanho ? `<div class="pedido-item-info">Tamanho: ${item.tamanho}</div>` : ''}
                        ${item.cor ? `<div class="pedido-item-info">Cor: ${item.cor}</div>` : ''}
                        <div class="pedido-item-info">Qtd: ${item.quantidade}</div>
                        <div class="pedido-item-preco">R$ ${item.preco.toFixed(2)}</div>
                    </div>
                </div>
            `).join('');

            // Card do Pedido Completo
            return `
                <div class="pedido-card">
                    <div class="pedido-header-card">
                        <div class="pedido-info">
                            <div class="pedido-info-item">
                                <span class="pedido-info-label">Pedido</span>
                                <span class="pedido-info-value">#${pedido.id}</span>
                            </div>
                            <div class="pedido-info-item">
                                <span class="pedido-info-label">Data</span>
                                <span class="pedido-info-value">${dataFormatada}</span>
                            </div>
                            <div class="pedido-info-item">
                                <span class="pedido-info-label">Total</span>
                                <span class="pedido-info-value" style="color: var(--primary-yellow);">R$ ${pedido.total.toFixed(2)}</span>
                            </div>
                        </div>
                        <span class="pedido-status ${statusInfo.class}">${statusInfo.text}</span>
                    </div>

                    <div class="pedido-body">
                        <div class="pedido-itens">
                            ${itensHtml}
                        </div>
                    </div>

                    <div class="pedido-footer">
                        <div class="pedido-acoes" style="width: 100%; text-align: right;">
                            ${podeCancelar ? `
                                <button class="btn-cancelar" onclick="cancelarPedido(${pedido.id})">
                                    Cancelar Pedido
                                </button>
                            ` : '<span style="font-size: 0.9rem; color: #666;">Este pedido n√£o pode mais ser cancelado.</span>'}
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // Fun√ß√£o para cancelar pedido
    function cancelarPedido(pedidoId) {
        if (!confirm('Tem certeza que deseja cancelar este pedido? Essa a√ß√£o n√£o pode ser desfeita.')) {
            return;
        }

        // Chama fun√ß√£o do database.js
        const result = db.cancelOrder(pedidoId);

        if (result.success) {
            // Se o pedido foi cancelado, idealmente dever√≠amos devolver o estoque
            // Mas para este escopo, apenas mudamos o status
            showNotification('Sucesso', 'Pedido cancelado com sucesso!');
            loadPedidos(); // Recarrega a lista para mostrar o novo status
        } else {
            showNotification('Erro', result.message || 'Erro ao cancelar pedido');
        }
    }
</script>
    <script src="script.js"></script>
</body>

</html>